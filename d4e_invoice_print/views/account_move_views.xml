<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="qr_image_view_form" model="ir.ui.view">
        <field name="name">QR Image</field>
        <field name="model">qr.image</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name" invisible="1"/>
                        <field name="qr_image" widget="image" filename="name"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
        <record id="qr_image_view_tree" model="ir.ui.view">
        <field name="name">QR Image</field>
        <field name="model">qr.image</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name" />
                <field name="qr_image" widget="image" filename="name" options="{&quot;size&quot;:[0,100]}" optional="hide"/>
            </tree>
        </field>
    </record>

    <record id="action_qr_image" model="ir.actions.act_window">
        <field name="name">QR Image</field>
        <field name="res_model">qr.image</field>
        <field name="view_mode">tree,form</field>
    </record>

        <menuitem id="qr_image_menu"
            parent="account.menu_finance_receivables"
            action="action_qr_image"
            sequence="120" />

    <record id="view_move_form" model="ir.ui.view">
        <field name="name">account.move.form</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <field name="invoice_date" position="after">
                <field name="print_date" readonly="1"/>
                <field name="printed" readonly="1"/>
                <field name="sent" readonly="1"/>
                <field name="qr_image" invisible="1" />
            </field>
        </field>
    </record>

    <record id="action_move_print" model="ir.actions.server">
        <field name="name">Print Invoice</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="state">code</field>
        <field name="code">
            if records:
                action = env.ref('account.account_invoices').report_action(records)
        </field>
    </record>

    <record id="action_print_isr_on_invoice" model="ir.actions.server">
        <field name="name">Print invoice with ISR</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="state">code</field>
        <field name="code">
            if records:
                action = env.ref('d4e_invoice_print.report_account_invoices_with_isr').report_action(records)
        </field>
    </record>

    <record id="action_print_qr_on_invoice" model="ir.actions.server">
        <field name="name">Print invoice with QR</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="binding_model_id" ref="account.model_account_move"/>
        <field name="state">code</field>
        <field name="code">
            if records and records.filtered(lambda r: r.state == 'posted' and r.move_type == 'out_invoice'):
                action = env.ref('d4e_invoice_print.report_account_invoices_with_qr').report_action(records.filtered(lambda r: r.state == 'posted' and r.move_type == 'out_invoice'))
        </field>
    </record>

    <record id="view_move_form_inherit_qr" model="ir.ui.view">
        <field name="name">invoice.move.form.inherit.qr</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <button name="%(action_print_qr_on_invoice)d" class="oe_highlight" string="Print invoice with QR"
                        type="action"/>
            </xpath>
        </field>
    </record>
</odoo>
